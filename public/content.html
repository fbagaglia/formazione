<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aula Virtuale | AUD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --nero: #0C0D0D;
            --verde: #379557;
            --bianco-testo: #F2F5F3;
        }
        body { 
            background-color: var(--nero); 
            color: var(--bianco-testo); 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
        }
        .hero-gradient { 
            background: radial-gradient(circle at top right, rgba(55, 149, 87, 0.08), var(--nero) 60%); 
            min-height: 100vh; 
        }
        .glass-card { 
            background: rgba(255, 255, 255, 0.02); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .glass-card:hover {
            border-color: var(--verde);
            background: rgba(255, 255, 255, 0.04);
        }
    </style>
</head>
<body class="hero-gradient">
    <header class="border-b border-white/10 sticky top-0 bg-black/90 backdrop-blur-md z-50">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="cursor-pointer flex items-center gap-4" onclick="window.location.href='index.html'">
                <div class="w-10 h-10 bg-[#379557] rounded-lg flex items-center justify-center text-white font-bold shadow-lg">AUD</div>
                <h1 id="course-title" class="text-white text-sm font-black uppercase tracking-widest truncate max-w-[300px]">Caricamento...</h1>
            </div>
            <button onclick="window.history.back()" class="text-[#379557] text-xs font-bold uppercase tracking-widest hover:text-white transition-colors">
                ← ESCI DALL'AULA
            </button>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-12">
        <div class="grid lg:grid-cols-12 gap-12">
            
            <!-- Colonna Principale: Bacheca e Materiali -->
            <div class="lg:col-span-8 space-y-10">
                <section>
                    <div class="flex items-center gap-3 mb-8">
                        <span class="w-8 h-[1px] bg-verde"></span>
                        <h3 class="text-xs font-black uppercase tracking-[0.3em] text-verde">Bacheca e Materiali</h3>
                    </div>
                    <div id="announcements-list" class="space-y-6">
                        <div class="p-10 glass-card rounded-3xl animate-pulse text-white/20">Sincronizzazione in corso...</div>
                    </div>
                </section>
            </div>

            <!-- Colonna Laterale: Compiti e Attività -->
            <aside class="lg:col-span-4 space-y-10">
                <section>
                    <div class="flex items-center gap-3 mb-8">
                        <span class="w-8 h-[1px] bg-verde"></span>
                        <h3 class="text-xs font-black uppercase tracking-[0.3em] text-verde">Lavori del Corso</h3>
                    </div>
                    <div id="assignments-list" class="space-y-4">
                        <div class="p-6 glass-card rounded-2xl animate-pulse text-white/20">Verifica compiti...</div>
                    </div>
                </section>

                <div class="p-8 bg-verde/5 border border-verde/20 rounded-[32px]">
                    <h4 class="text-white font-bold mb-3">Assistenza Didattica</h4>
                    <p class="text-gray-400 text-xs leading-relaxed mb-6">Incontra difficoltà con i materiali o le consegne? La nostra community e i tutor sono qui per aiutarti.</p>
                    <a href="#" class="text-verde text-xs font-black uppercase tracking-widest hover:underline">Contatta Supporto →</a>
                </div>
            </aside>
        </div>
    </main>

    <script>
        const params = new URLSearchParams(window.location.search);
        const courseId = params.get('id');

        async function init() {
            if (!courseId) {
                window.location.href = 'index.html';
                return;
            }

            try {
                // Carichiamo i dati reali dalle rotte Hono appena create
                const [courseRes, annRes, workRes] = await Promise.all([
                    fetch(`/api/classroom/courses/${courseId}`),
                    fetch(`/api/classroom/courses/${courseId}/announcements`),
                    fetch(`/api/classroom/courses/${courseId}/coursework`)
                ]);

                if (!courseRes.ok) throw new Error("Errore caricamento dati corso");

                const course = await courseRes.json();
                const announcements = await annRes.json();
                const assignments = await workRes.json();
                
                document.getElementById('course-title').innerText = course.title || "Aula Virtuale";
                
                renderAnnouncements(announcements);
                renderAssignments(assignments);

            } catch (e) {
                console.error("Errore nel caricamento dell'aula:", e);
                document.getElementById('announcements-list').innerHTML = `
                    <div class='p-10 glass-card rounded-3xl text-red-500/80 font-bold text-center'>
                        Errore di sincronizzazione. Assicurati che il corso esista e che i permessi siano attivi.
                    </div>`;
            }
        }

        function renderAnnouncements(data) {
            const list = document.getElementById('announcements-list');
            if (!data || data.length === 0) {
                list.innerHTML = `<div class='p-10 glass-card rounded-3xl text-gray-500 italic text-center'>Nessun materiale o bacheca disponibile.</div>`;
                return;
            }

            list.innerHTML = data.map(ann => `
                <div class="p-10 glass-card rounded-[32px]">
                    <div class="flex justify-between items-center mb-6">
                        <span class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">
                            Postato il ${new Date(ann.updateTime).toLocaleDateString('it-IT')}
                        </span>
                    </div>
                    <div class="text-white/90 text-base leading-relaxed whitespace-pre-wrap">${ann.text || "Messaggio senza testo"}</div>
                    ${ann.materials ? `
                        <div class="mt-8 pt-6 border-t border-white/5">
                            <p class="text-[10px] text-verde font-black uppercase tracking-widest mb-2">Materiali Allegati</p>
                            <p class="text-xs text-gray-500 italic">Disponibili per la consultazione su Google Classroom.</p>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function renderAssignments(data) {
            const list = document.getElementById('assignments-list');
            if (!data || data.length === 0) {
                list.innerHTML = `<div class='p-6 glass-card rounded-2xl text-gray-500 text-xs italic text-center'>Nessuna attività programmata.</div>`;
                return;
            }

            list.innerHTML = data.map(work => `
                <div class="p-6 glass-card rounded-2xl group transition-all">
                    <h4 class="font-bold text-white text-sm mb-4 leading-snug group-hover:text-verde transition-colors">${work.title}</h4>
                    <a href="${work.alternateLink}" target="_blank" class="block w-full py-3 bg-verde/10 hover:bg-verde text-verde hover:text-white text-center rounded-xl text-[10px] font-black uppercase tracking-[0.2em] transition-all">
                        APRI ATTIVITÀ
                    </a>
                </div>
            `).join('');
        }

        window.onload = init;
    </script>
</body>
</html>
